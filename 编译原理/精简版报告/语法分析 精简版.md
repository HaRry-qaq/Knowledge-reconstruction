### 三、方法一：递归

#### 1、原理分析

​		为了通过递归调用程序实现自顶向下的分析，我们**需要将产生式进行变形，使之没有左递归，提取左公因子**，并且生成非终结符的first集合和follow集合。随后根据**最左推导**的方式完成语句的分析。

#### 2、前置运算

##### ① 消除左递归，提取左公因子

​		对于形如

<img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221115195725830.png" alt="image-20221115195725830" style="zoom:50%;" />

​		使用如下公式：



<img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221115195624459.png" alt="image-20221115195624459" style="zoom: 50%;" />

​		可以得到消除左递归后的文法如下（e为空符号，n为num）：
$$
E \rightarrow TP\\
    P\rightarrow+TP\\
    P\rightarrow-TP\\
    P\rightarrow e\\
    T\rightarrow FQ\\
    Q\rightarrow *FQ\\
    Q\rightarrow /FQ\\
    Q\rightarrow e\\
    F\rightarrow (E)\\
    F\rightarrow n\\
$$


##### ② 生成first集合与follow集合

​		生成的first集合与follow集合如下：

|        |    E    |    P    |     T      |     Q      |        F         |
| :----: | :-----: | :-----: | :--------: | :--------: | :--------------: |
| FIRST  | ( , num | +, -, e |   (, num   |  *, /, e   |      (, num      |
| FOLLOW |  ) , $  |  $, )   | +, -, $, ) | +, -, $, ) | *, /, +, -, $, ) |

#### 3、实现：

- 构造每一个产生式左方非终结符的函数，按照产生式右方的符号依次执行代码。利用判断区分同一个左方非终结符的不同产生式。



### 四、方法二：LL(1)分析

#### 1、原理分析

​		由于我们需要编写LL(1)语法分析程序，所以我们首先需要将给出的文法变为LL(1)文法，再写出相应的first集合和follow集合，以使用算法4.2自动构造预测分析表；随后根据预测分析表构造LL(1)预测分析程序。**LL(1)同样是自上而下的分析方法，而且是有效的无回溯的。**无回溯的原因是构造并使用了分析表。



#### 2、前置运算

##### ① 改写文法（与方法一是一致的）

$$
E\rightarrow TP\\
    P\rightarrow +TP\\
    P\rightarrow -TP\\
    P\rightarrow e\\
    T\rightarrow FQ\\
    Q\rightarrow *FQ\\
    Q\rightarrow /FQ\\
    Q\rightarrow e\\
    F\rightarrow (E)\\
    F\rightarrow n\\
$$





##### ② 生成first集合与follow集合

|        |   E    |    P    |     T      |     Q      |        F         |
| :----: | :----: | :-----: | :--------: | :--------: | :--------------: |
| FIRST  | (, num | +, -, e |   (, num   |  *, /, e   |      (, num      |
| FOLLOW |  $, )  |  $, )   | +, -, $, ) | +, -, $, ) | *, /, +, -, $, ) |



##### ③ LL(1)预测分析表（目的是为了验证生成的分析表是否正确）

|      |   +   |   -   |   *   |   /   |   (   |  )   |  num  |  $   |
| :--: | :---: | :---: | :---: | :---: | :---: | :--: | :---: | :--: |
|  E   |       |       |       |       | E→TP  |      | E→TP  |      |
|  P   | P→+TP | P→-TP |       |       |       | P→e  |       | P→e  |
|  T   |       |       |       |       | T→FQ  |      | T→FQ  |      |
|  Q   |  Q→e  |  Q→e  | Q→*FQ | Q→/FQ |       | Q→e  |       | Q→e  |
|  F   |       |       |       |       | F→(E) |      | F→num |      |

![image-20221116220542204](C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221116220542204.png)

<img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221116220646745.png" alt="image-20221116220646745" style="zoom: 80%;" />

#### 3、实现：

- ​	使用table数组记录预测分析表。

  - <img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221118102336527.png" alt="image-20221118102336527" style="zoom:67%;" />

- 使用p数组记录表中某处是否存在产生式。

  - <img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221118102505800.png" alt="image-20221118102505800" style="zoom: 80%;" />
  - 代码前半部分使用switch语句，提高可读性；后半部分输出使用unordered_map，不再重复case过程，缩减代码冗余，增加效率。

  



### 五、方法三：LR分析

#### 1、原理分析

​		LR分析实际上是从下而上的分析，**是最右推导的逆过程，也就是最左规约**。**为了分析器只有一个接受状态（LR分析以归约到初始符号为接受），我们需要对文法进行增广**。然后求first集与follow集，构造识别所有活前缀的DFA，构造项目集规范族，并以此构造LR分析表，最后使用LR分析表完成算法的实现。



#### 2、前置运算

##### ① 增广文法

$$
	S\rightarrow E \\
    E\rightarrow E+T\\
    E\rightarrow E-T\\
    E\rightarrow T\\
    T\rightarrow T*F\\
    T\rightarrow T/F\\
    T\rightarrow F\\
    F\rightarrow (E)\\
    F\rightarrow n
$$



##### ② 生成first集合与follow集合

|        |   S    |     E      |        T         |        F         |
| :----: | :----: | :--------: | :--------------: | :--------------: |
| FIRST  | (, num |   (, num   |      (, num      |      (, num      |
| FOLLOW |   $    | +, -, $, ) | *, /, +, -, $, ) | *, /, +, -, $, ) |



##### ③ 识别所有活前缀的DFA，构造项目及规范族（略，可以在LR分析表中体现）



##### ④ LR分析表

|  状  |      |  A   |  C   |  T   |  I   |  O   |  N   |      |  G   |  O   |  T   |  O   |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|  态  |  (   |  )   |  +   |  -   |  *   |  /   | num  |  $   |  S   |  E   |  T   |  F   |
|  0   |  S4  |      |      |      |      |      |  S5  |      |      |  1   |  2   |  3   |
|  1   |      |      |  S6  |  S7  |      |      |      | acc  |      |      |      |      |
|  2   |      |  R4  |  R4  |  R4  |  S8  |  S9  |      |  R4  |      |      |      |      |
|  3   |      |  R7  |  R7  |  R7  |  R7  |  R7  |      |  R7  |      |      |      |      |
|  4   |  S4  |      |      |      |      |      |  S5  |      |      |  10  |  2   |  3   |
|  5   |      |  R9  |  R9  |  R9  |  R9  |  R9  |      |  R9  |      |      |      |      |
|  6   |  S4  |      |      |      |      |      |  S5  |      |      |      |  11  |  3   |
|  7   |  S4  |      |      |      |      |      |  S5  |      |      |      |  12  |  3   |
|  8   |  S4  |      |      |      |      |      |  S5  |      |      |      |      |  13  |
|  9   |  S4  |      |      |      |      |      |  S5  |      |      |      |      |  14  |
|  10  |      | S15  |  S6  |  S7  |      |      |      |      |      |      |      |      |
|  11  |      |  R2  |  R2  |  R2  |  S8  |  S9  |      |  R2  |      |      |      |      |
|  12  |      |  R3  |  R3  |  R3  |  S8  |  S9  |      |  R3  |      |      |      |      |
|  13  |      |  R5  |  R5  |  R5  |  R5  |  R5  |      |  R5  |      |      |      |      |
|  14  |      |  R6  |  R6  |  R6  |  R6  |  R6  |      |  R6  |      |      |      |      |
|  15  |      |  R8  |  R8  |  R8  |  R8  |  R8  |      |  R8  |      |      |      |      |

<img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221116222359871.png" alt="image-20221116222359871" style="zoom:80%;" />

#### 3、实现

- 无需画出表格，所以全程使用unordered_map，目的是使用符号映射到下标。
  - <img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221118102803389.png" alt="image-20221118102803389" style="zoom:80%;" />
- 使用action数组、goto数组记录表格内容：
  - <img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221118102859343.png" alt="image-20221118102859343" style="zoom:80%;" />
  - <img src="C:\Users\HaRry_\AppData\Roaming\Typora\typora-user-images\image-20221118102911137.png" alt="image-20221118102911137" style="zoom:80%;" />







